<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tav≈üan Yapƒ±cƒ± - Tablet Modu</title>
    <style>
        body {
            font-family: 'Comic Sans MS', 'Arial', sans-serif;
            background-color: #E1F5FE;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden; /* Kaydƒ±rmayƒ± engelle */
        }

        /* --- √úST PANEL (EDƒ∞T√ñR ARA√áLARI) --- */
        .editor-bar {
            background: white;
            width: 95%; /* Mobilde kenarlara yapƒ±≈ümasƒ±n */
            padding: 10px;
            border-radius: 0 0 15px 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-shrink: 0; /* K√º√ß√ºlmesin */
            z-index: 10;
        }

        .tool-group {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .tool-btn {
            width: 45px;
            height: 45px;
            font-size: 1.5rem;
            border: 2px solid #ddd;
            border-radius: 8px;
            background: #fff;
            cursor: pointer;
            transition: all 0.2s;
            /* Dokunmatik i√ßin basma hissi */
            touch-action: manipulation; 
        }
        
        .tool-btn.active {
            border-color: #2196F3;
            background-color: #E3F2FD;
            transform: scale(1.05);
            box-shadow: 0 0 8px rgba(33, 150, 243, 0.5);
        }

        .size-input {
            width: 40px;
            padding: 5px;
            font-size: 1.1rem;
            border-radius: 5px;
            border: 1px solid #ccc;
            text-align: center;
        }

        /* --- ANA OYUN ALANI (Responsive) --- */
        .game-wrapper {
            display: flex;
            gap: 20px;
            align-items: flex-start;
            justify-content: center;
            width: 100%;
            height: 100%;
            overflow: auto; /* K√º√ß√ºk ekranlarda kaydƒ±rma */
            padding-bottom: 20px;
        }

        .grid-board {
            display: grid;
            gap: 3px;
            background-color: #AED581;
            padding: 8px;
            border-radius: 12px;
            border: 5px solid #558b2f;
            /* Tablette ortalanmasƒ± i√ßin */
            margin: 0 auto;
            touch-action: none; /* √áift dokunma zoom'unu engeller */
        }

        .cell {
            /* Dinamik boyutlandƒ±rma JS ile yapƒ±lacak */
            width: 50px; 
            height: 50px;
            background-color: #DCEDC8;
            border-radius: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2rem;
            cursor: pointer;
            user-select: none;
        }

        .wall { background-color: #33691e; }
        .rabbit { background-color: #FFF9C4; }

        /* --- SAƒû PANEL (OYUNCU KONTROLLERƒ∞) --- */
        .play-panel {
            display: none;
            flex-direction: column;
            align-items: center;
            width: 260px;
            background: white;
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.15);
            margin-right: 10px;
        }

        .command-area {
            width: 100%;
            min-height: 80px;
            max-height: 150px; /* √áok uzarsa kaydƒ±r */
            overflow-y: auto;
            background-color: #f5f5f5;
            border: 2px dashed #bbb;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            flex-wrap: wrap;
            padding: 5px;
            gap: 4px;
        }

        .queue-arrow {
            width: 28px;
            height: 28px;
            font-size: 1rem;
            background: #fff;
            border-radius: 3px;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 1px solid #ddd;
        }

        .current-command {
            background-color: #FF5722 !important;
            color: white !important;
            transform: scale(1.15);
            border-color: #E64A19;
        }

        .arrows-pad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 10px;
        }

        .btn {
            width: 55px;
            height: 55px;
            font-size: 1.8rem;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            box-shadow: 0 3px 0 rgba(0,0,0,0.2);
            touch-action: manipulation;
        }
        .btn:active { transform: translateY(3px); box-shadow: none; }
        .btn-arrow { background-color: #FFEB3B; color: #d35400; }
        
        .action-btns {
            width: 100%;
            display: flex;
            gap: 10px;
        }

        .btn-go { background-color: #4CAF50; color: white; flex: 2; font-size: 1.2rem; border-radius: 10px; padding: 10px; }
        .btn-reset { background-color: #F44336; color: white; flex: 1; font-size: 1.5rem; border-radius: 10px; padding: 10px; }

        .mode-btn {
            padding: 8px 15px;
            font-size: 1rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            white-space: nowrap;
        }
        .btn-start-play { background-color: #4CAF50; color: white; box-shadow: 0 3px 0 #2E7D32; }
        .btn-edit-mode { background-color: #2196F3; color: white; display: none; margin-bottom: 10px; width: 100%; box-shadow: 0 3px 0 #1565C0; }

        /* --- TABLET / MOBƒ∞L ƒ∞√áƒ∞N MEDYA SORGULARI --- */
        @media (max-width: 900px) {
            .game-wrapper {
                flex-direction: column; /* Yan yana deƒüil alt alta */
                align-items: center;
                justify-content: flex-start;
                padding-top: 10px;
            }

            .grid-board {
                margin-bottom: 20px;
            }

            .play-panel {
                width: 90%; /* Ekran geni≈üliƒüini kullan */
                flex-direction: row; /* Kontrolleri yatay diz */
                flex-wrap: wrap;
                justify-content: center;
                margin-right: 0;
            }

            .command-area {
                width: 100%;
                order: 1;
            }

            .arrows-pad {
                order: 2;
                margin-right: 20px;
            }

            .action-btns {
                order: 3;
                width: auto;
                flex-direction: column;
                justify-content: center;
            }
            
            .btn-edit-mode {
                order: 0;
            }
        }
        
        /* √áok k√º√ß√ºk ekranlar i√ßin dikey hizalama */
        @media (max-width: 500px) {
             .play-panel {
                flex-direction: column;
             }
             .arrows-pad { margin-right: 0; }
             .action-btns { width: 100%; flex-direction: row; }
        }

        #overlay {
            position: absolute; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center; align-items: center; z-index: 100;
        }
        .popup { background: white; padding: 30px; border-radius: 20px; text-align: center; width: 80%; max-width: 300px; }

    </style>
</head>
<body>

    <div class="editor-bar" id="editor-controls">
        <div class="tool-group">
            <span style="font-weight:bold; color:#555; font-size: 0.9rem;">Boyut:</span>
            <input type="number" id="grid-size" class="size-input" value="5" min="3" max="10" onchange="createGrid()">
            <button class="mode-btn btn-start-play" onclick="switchToPlayMode()">OYNA ‚ñ∂Ô∏è</button>
        </div>
        
        <div class="tool-group">
            <button class="tool-btn active" onclick="selectTool('wall')" title="Duvar">üå≥</button>
            <button class="tool-btn" onclick="selectTool('rabbit')" title="Tav≈üan">üê∞</button>
            <button class="tool-btn" onclick="selectTool('carrot')" title="Havu√ß">ü•ï</button>
            <button class="tool-btn" onclick="selectTool('eraser')" title="Silgi">‚¨ú</button>
        </div>
    </div>

    <div class="game-wrapper">
        <div class="grid-board" id="board"></div>

        <div class="play-panel" id="play-controls">
            <button class="mode-btn btn-edit-mode" onclick="switchToEditMode()">‚úèÔ∏è D√ºzenle</button>
            
            <div class="command-area" id="queue-display">Komutlar buraya...</div>

            <div class="arrows-pad">
                <div></div>
                <button class="btn btn-arrow" onclick="addCommand('up')">‚¨ÜÔ∏è</button>
                <div></div>
                <button class="btn btn-arrow" onclick="addCommand('left')">‚¨ÖÔ∏è</button>
                <button class="btn btn-arrow" onclick="addCommand('down')">‚¨áÔ∏è</button>
                <button class="btn btn-arrow" onclick="addCommand('right')">‚û°Ô∏è</button>
            </div>

            <div class="action-btns">
                <button class="btn btn-go" onclick="runCode()">BA≈ûLA</button>
                <button class="btn btn-reset" onclick="resetCommands()">üóëÔ∏è</button>
            </div>
        </div>
    </div>

    <div id="overlay">
        <div class="popup">
            <h2 id="popup-title">Mesaj</h2>
            <p id="popup-msg">ƒ∞√ßerik</p>
            <button class="mode-btn btn-start-play" onclick="closePopup()">Tamam</button>
        </div>
    </div>

<script>
    // --- DEƒûƒ∞≈ûKENLER ---
    let gridSize = 5;
    let mode = 'EDIT'; 
    let currentTool = 'wall'; 
    let mapData = []; 
    let rabbitStartPos = null;
    let playRabbitPos = {x:0, y:0};
    let commands = [];
    let isRunning = false;

    // --- BA≈ûLANGI√á ---
    window.onload = () => {
        createGrid();
        window.addEventListener('resize', adjustCellSize); // Ekran d√∂n√ºnce boyutu ayarla
    };

    // --- EDƒ∞T√ñR FONKSƒ∞YONLARI ---
    
    function createGrid() {
        const sizeInput = document.getElementById('grid-size');
        if (sizeInput.value < 3) sizeInput.value = 3;
        if (sizeInput.value > 10) sizeInput.value = 10; // Tablet i√ßin max 10 iyidir
        
        gridSize = parseInt(sizeInput.value);
        mapData = [];
        rabbitStartPos = null;

        const board = document.getElementById('board');
        board.innerHTML = '';

        // Bo≈ü Harita Olu≈ütur
        for (let y = 0; y < gridSize; y++) {
            let row = [];
            for (let x = 0; x < gridSize; x++) {
                row.push(0);
                const cell = document.createElement('div');
                cell.classList.add('cell');
                cell.dataset.x = x;
                cell.dataset.y = y;
                // Hem click hem touchstart ekleyelim ki tablette hƒ±zlƒ± tepki versin
                cell.onclick = () => onCellClick(x, y); 
                board.appendChild(cell);
            }
            mapData.push(row);
        }
        
        adjustCellSize(); // H√ºcre boyutlarƒ±nƒ± ekran boyutuna g√∂re ayarla
    }

    // Ekran boyutuna g√∂re h√ºcreleri otomatik ayarla (Responsive Grid)
    function adjustCellSize() {
        const board = document.getElementById('board');
        // Ekranƒ±n kƒ±sa kenarƒ±nƒ± bul veya max geni≈ülik belirle
        const availableWidth = Math.min(window.innerWidth - 40, 500); 
        // Izgara boyutuna b√∂l
        const cellSize = Math.floor((availableWidth - (gridSize * 4)) / gridSize);
        
        // CSS Grid ≈üablonunu g√ºncelle
        board.style.gridTemplateColumns = `repeat(${gridSize}, ${cellSize}px)`;
        board.style.gridTemplateRows = `repeat(${gridSize}, ${cellSize}px)`;

        // H√ºcrelerin i√ßindeki yazƒ± boyutunu da ayarla
        const cells = document.querySelectorAll('.cell');
        cells.forEach(c => {
            c.style.width = `${cellSize}px`;
            c.style.height = `${cellSize}px`;
            c.style.fontSize = `${cellSize * 0.6}px`; // Emoji boyutu
        });
    }

    function selectTool(tool) {
        currentTool = tool;
        document.querySelectorAll('.tool-btn').forEach(btn => btn.classList.remove('active'));
        const btnMap = {'wall':0, 'rabbit':1, 'carrot':2, 'eraser':3};
        // Null check ekleyelim hata almasƒ±n
        const btns = document.querySelectorAll('.tool-btn');
        if(btns[btnMap[tool]]) btns[btnMap[tool]].classList.add('active');
    }

    function onCellClick(x, y) {
        if (mode !== 'EDIT') return;

        const currentVal = mapData[y][x];

        if (currentTool === 'rabbit') {
            clearItemFromMap(2); 
            mapData[y][x] = 2;
        } else if (currentTool === 'carrot') {
            clearItemFromMap(3);
            mapData[y][x] = 3;
        } else if (currentTool === 'wall') {
            mapData[y][x] = (currentVal === 1) ? 0 : 1;
        } else if (currentTool === 'eraser') {
            mapData[y][x] = 0;
        }

        renderBoard();
    }

    function clearItemFromMap(itemCode) {
        for(let y=0; y<gridSize; y++) {
            for(let x=0; x<gridSize; x++) {
                if(mapData[y][x] === itemCode) mapData[y][x] = 0;
            }
        }
    }

    function renderBoard(isPlaying = false) {
        const board = document.getElementById('board');
        const cells = board.children;

        for (let y = 0; y < gridSize; y++) {
            for (let x = 0; x < gridSize; x++) {
                const index = y * gridSize + x;
                const cell = cells[index];
                const val = mapData[y][x];

                // Temizle (Classlarƒ± koruyarak sadece i√ßeriƒüi silmek daha performanslƒ± olur ama bu basit)
                cell.className = 'cell';
                cell.innerText = '';
                cell.style.backgroundColor = '#DCEDC8';
                
                // Yeniden boyutlandƒ±rma i√ßin inline style'ƒ± korumak gerekebilir, 
                // ama adjustCellSize zaten √ßalƒ±≈üƒ±yor. Biz sadece class ekleyelim.

                if (!isPlaying) {
                    if (val === 1) { cell.classList.add('wall'); cell.innerText = 'üå≥'; }
                    else if (val === 2) { cell.innerText = 'üê∞'; cell.style.backgroundColor = '#FFF9C4'; }
                    else if (val === 3) { cell.innerText = 'ü•ï'; }
                } else {
                    if (val === 1) { cell.classList.add('wall'); cell.innerText = 'üå≥'; }
                    else if (val === 3) { cell.innerText = 'ü•ï'; }
                    
                    if (x === playRabbitPos.x && y === playRabbitPos.y) {
                        cell.innerText = 'üê∞';
                        cell.style.backgroundColor = '#FFF9C4';
                    }
                }
            }
        }
        adjustCellSize(); // Render sonrasƒ± boyutlarƒ± garantiye al
    }

    // --- MOD GE√áƒ∞≈ûLERƒ∞ ---
    
    function switchToPlayMode() {
        let hasRabbit = false;
        let hasCarrot = false;

        for(let row of mapData) {
            if(row.includes(2)) hasRabbit = true;
            if(row.includes(3)) hasCarrot = true;
        }

        if (!hasRabbit) { showPopup("Uyarƒ±", "L√ºtfen haritaya bir Tav≈üan (üê∞) koy!"); return; }
        if (!hasCarrot) { showPopup("Uyarƒ±", "L√ºtfen haritaya bir Havu√ß (ü•ï) koy!"); return; }

        for(let y=0; y<gridSize; y++) {
            for(let x=0; x<gridSize; x++) {
                if(mapData[y][x] === 2) {
                    rabbitStartPos = {x, y};
                    playRabbitPos = {x, y};
                }
            }
        }

        mode = 'PLAY';
        commands = [];
        updateQueueDisplay();
        
        document.getElementById('editor-controls').style.display = 'none';
        
        // Tablette panel g√∂r√ºn√ºm√ºn√º d√ºzeltmek i√ßin display flex yapƒ±yoruz
        const playControl = document.getElementById('play-controls');
        playControl.style.display = 'flex'; 
        
        document.querySelector('.btn-edit-mode').style.display = 'block';

        renderBoard(true);
    }

    function switchToEditMode() {
        if(isRunning) return;
        
        mode = 'EDIT';
        document.getElementById('editor-controls').style.display = 'flex';
        document.getElementById('play-controls').style.display = 'none';
        
        renderBoard(false);
    }

    // --- OYUN MANTIƒûI ---

    function addCommand(direction) {
        if (isRunning) return;
        if (commands.length < 30) { // Tablette daha √ßok yer olabilir, limiti artƒ±rdƒ±m
            commands.push(direction);
            updateQueueDisplay();
        }
    }

    function updateQueueDisplay() {
        const display = document.getElementById('queue-display');
        display.innerHTML = '';
        if (commands.length === 0) {
            display.innerText = "Komutlar buraya...";
            return;
        }

        const arrows = { 'up': '‚¨ÜÔ∏è', 'down': '‚¨áÔ∏è', 'left': '‚¨ÖÔ∏è', 'right': '‚û°Ô∏è' };
        commands.forEach((cmd, index) => {
            const div = document.createElement('div');
            div.className = 'queue-arrow';
            div.innerText = arrows[cmd];
            div.id = `cmd-${index}`;
            display.appendChild(div);
        });
        
        // Yeni komut eklendiƒüinde en sona kaydƒ±r
        display.scrollTop = display.scrollHeight;
    }

    function resetCommands() {
        if (isRunning) return;
        commands = [];
        playRabbitPos = {...rabbitStartPos}; 
        updateQueueDisplay();
        renderBoard(true);
    }

    async function runCode() {
        if (commands.length === 0 || isRunning) return;
        
        isRunning = true;
        playRabbitPos = {...rabbitStartPos};
        renderBoard(true);

        const arrowElements = document.getElementsByClassName('queue-arrow');

        for (let i = 0; i < commands.length; i++) {
            if(arrowElements[i]) {
                arrowElements[i].classList.add('current-command');
                // Aktif komutu g√∂r√ºn√ºr yap
                arrowElements[i].scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
            }

            await moveRabbit(commands[i]);

            if(arrowElements[i]) arrowElements[i].classList.remove('current-command');

            if (mapData[playRabbitPos.y][playRabbitPos.x] === 3) {
                showPopup("Tebrikler! üéâ", "Tav≈üan havucu yedi!");
                isRunning = false;
                return;
            }
        }
        
        isRunning = false;
    }

    function moveRabbit(direction) {
        return new Promise(resolve => {
            setTimeout(() => {
                let newX = playRabbitPos.x;
                let newY = playRabbitPos.y;

                if (direction === 'up') newY--;
                if (direction === 'down') newY++;
                if (direction === 'left') newX--;
                if (direction === 'right') newX++;

                if (newX >= 0 && newX < gridSize && newY >= 0 && newY < gridSize) {
                    if (mapData[newY][newX] !== 1) {
                        playRabbitPos = {x: newX, y: newY};
                        renderBoard(true);
                    }
                }
                resolve();
            }, 500);
        });
    }

    function showPopup(title, msg) {
        document.getElementById('popup-title').innerText = title;
        document.getElementById('popup-msg').innerText = msg;
        document.getElementById('overlay').style.display = 'flex';
    }

    function closePopup() {
        document.getElementById('overlay').style.display = 'none';
        if (mode === 'PLAY') {
             resetCommands();
        }
    }

</script>
</body>
</html>